<!doctype HTML>
<html>
    <head>
      <title>Arp</title>
      <meta charset="utf-8" />
    </head>

    <body>
        <div id="main"></div>
        <script type="text/javascript" src="main.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Cinzel:400" rel="stylesheet">
        <link rel="stylesheet" href="style.css">
        <script>
         "use strict"
         var app = Elm.Instrument.fullscreen();

         var context = new (window.AudioContext || window.webkitAudioContext)();

         var filter = context.createBiquadFilter();
         filter.type = 'lowpass';
         filter.frequency.value = 3000;
         filter.connect(context.destination);


         /* function playNote (frequency) {*/
         function playNote (frequency, duration) {
           var osc = context.createOscillator();
           var amp = context.createGain();

           osc.type = 'triangle';
           osc.frequency.value = frequency;
           amp.gain.value = 0.2;

           osc.connect(amp);
           amp.connect(filter);
           /* gain.connect(context.destination);*/

           console.log(frequency + ", " + duration);
           var now = context.currentTime;
           osc.start();
           osc.stop(now + duration);
         };

         app.ports.play.subscribe(function (args) {
           var frequency = args.frequency;
           var duration = args.duration;
           /* console.log(args);*/
           playNote(frequency, duration);
         });

         /* app.ports.play.subscribe(function (args) {*/
         /* args.forEach(function(note) {*/
         /* var frequency = note.frequency;*/
         /* var duration = note.duration;*/
         /* console.log(note);*/
         /* playNote(frequency, duration);*/
         /* });*/
         /* });*/

        </script>
    </body>

</html>
